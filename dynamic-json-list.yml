---
- hosts: localhost
  gather_facts: no
  
  vars:
  
    # dictionary selected variable
    vm_size: vm_small

    # dictionary of values to query
    vm_spec:

      # vm sizes for vmware resources
      vm_small:  { cpu: 1, ram: 2  }
      vm_medium: { cpu: 2, ram: 4  }
      vm_large:  { cpu: 4, ram: 8  }
      vm_xlarge: { cpu: 8, ram: 16 }

    # dynamic list of valid values for dictionary selector
    vm_vals: "{{ vm_spec.keys() }}"

  tasks:
    
    - name: make new dynamic list
      set_fact:
        that_list: "{{ [ that_list|default([]) + this_list ] }}‚Äù
      loop: "{{ vm_spec }}"
      vars:
        this_list: [ { name: "{{item.key}}", cpu: "{{item.cpu}}", ram: "{{item.ram}}" } ]

    - name: DEBUG - that_list
      debug: var=that_list
